(function($){"use strict";var marqueeAttempts=0,marqueeTO,marqueeCheckResize;UNCODE.textMarquee=function($titles){var initTextMarquee=function($titles){typeof $titles=="undefined"&&($titles=$(".un-text-marquee"));if(!$titles.length)return;$titles.each(function(){var $title=$(this),$span=$("> span, > i > span",$title),txt,first=!0,dataSpeed=parseFloat($title.closest(".heading-text").attr("data-marquee-speed")),dataSpace=parseFloat($title.closest(".heading-text").attr("data-marquee-space")),dataTrigger=$title.closest(".heading-text").attr("data-marquee-trigger"),dataNavBar=$title.closest(".heading-text").attr("data-marquee-navbar"),dataNavBarMobile=$title.closest(".heading-text").attr("data-marquee-navbar-mobile"),newW=UNCODE.wwidth,marqueeTL,inview;if($title.closest(".sticky-trigger").length||$title.closest(".pin-spacer").length)dataTrigger="row";UNCODE.wwidth<=UNCODE.mediaQuery&&(dataNavBar=dataNavBarMobile),dataSpeed=isNaN(dataSpeed)?0:dataSpeed,dataSpace=isNaN(dataSpace)?"default":dataSpace;var dataX=dataSpeed;dataSpeed<0?dataSpeed-=1:dataSpeed>0&&(dataSpeed+=1),dataSpeed<=0?dataSpeed*=10:dataSpeed=dataSpeed*2-1,$(".marquee-clone-wrap",$title).remove(),txt=$span.html(),$(".marquee-original-core",$span).length?txt=$(".marquee-original-core",$span).html():(txt=$span.html(),$span=$("> span, > i > span",$title).wrapInner('<span class="marquee-original-core" />').addClass("marquee-original"));var spanW,$prepended=$('<span class="marquee-clone-wrap wrap-prepended" />'),$appended=$('<span class="marquee-clone-wrap wrap-appended" />'),speed=10-dataSpeed;$span.prepend($prepended),$span.append($appended);var continuousTextMarquee=function(){var bound=$title.css({transform:"none",opacity:0}).offset(),ease="none",xStrt=first||$title.hasClass("un-marquee-infinite")?0:UNCODE.wwidth-bound.left,xEnd=$title.hasClass("un-marquee-infinite")?spanW:spanW+bound.left,xSpeed=$title.hasClass("un-marquee-infinite")?spanW+bound.left:xStrt+(UNCODE.wwidth+bound.left),direction=$title.hasClass("un-marquee-opposite")?1:-1;marqueeTL=new TimelineMax({paused:!0,reversed:!0});var inViewElement=dataTrigger==="row"?$title.closest(".vc_row")[0]:$title[0],wayOff=dataTrigger==="row"&&dataNavBar==="yes"?UNCODE.menuHeight:0;inview=new Waypoint.Inview({element:inViewElement,offset:wayOff,enter:function(direction){marqueeTL.play()},exited:function(direction){$title.closest(".pin-spacer").length||marqueeTL.pause()}});if($title.hasClass("un-marquee-hover")){var $column=$title.closest(".wpb_column"),$col_link=$(".col-link",$column),$hover_sel=$title;$col_link.length&&($hover_sel=$title.add($column)),$hover_sel.on("mouseover",function(){speed=(10-dataSpeed)*5,ease="power2.out",marqueeTL.duration(xSpeed/UNCODE.wwidth*speed)}).on("mouseout",function(){speed=10-dataSpeed,ease="power2.in",marqueeTL.duration(xSpeed/UNCODE.wwidth*speed)})}gsap.killTweensOf($title),marqueeTL.fromTo($title,{opacity:1,x:xStrt*direction*-1},{duration:xSpeed/UNCODE.wwidth*speed,x:xEnd*direction,onComplete:function(){first=!1,continuousTextMarquee()},ease:ease})},runTextMarquee=function(){var time=Date.now(),textMarqueeScroll=function(){var $row=$title.closest(".vc_row"),$bound=dataTrigger==="row"||dataTrigger==="row-middle"?$row:$title;if(!$bound.length)return;var bound=$bound[0].getBoundingClientRect(),wait=100,direction=$title.hasClass("un-marquee-scroll-opposite")?-1:1,dataMove=dataX>=0?1+dataX:-1*5/(dataX-.5)*.25;bound.top===0&&bound.bottom===0&&bound.left===0&&bound.right===0&&bound.height===0&&bound.width===0&&bound.x===0&&bound.y===0&&marqueeAttempts<2&&(clearRequestTimeout(marqueeTO),marqueeTO=requestTimeout(function(){marqueeAttempts++,initTextMarquee()},100));var bound_top=bound.top,gsap_calc=(UNCODE.wheight*.35-bound_top)*dataMove*.5*direction;if(dataTrigger==="row"||dataTrigger==="row-middle")dataTrigger==="row-middle"&&(bound_top=bound.top+bound.height*.5-UNCODE.wheight*.5),dataNavBar==="yes"&&(bound_top-=UNCODE.menuHeight),gsap_calc=bound_top*dataMove*.5*direction;gsap.killTweensOf($title),gsap.to($title,{duration:.24,x:gsap_calc})};textMarqueeScroll(),$(window).on("load scroll",function(e){textMarqueeScroll()})},cloneSpan=function($_title,cntnt){$_title.hasClass("un-marquee-infinite")&&$("> span.marquee-clone-wrap",$_title).text(""),gsap.to($_title,{duration:0,x:0}),spanW=$span.outerWidth();if(!spanW)return;var part=Math.ceil(UNCODE.wwidth/spanW)*2,spaceSpan=dataSpace!=="default"?'<span class="marquee-space-'+dataSpace+'"> </span>':" ";if($_title.hasClass("un-marquee-infinite"))for(var i=0;i<part;i++)$prepended.append(cntnt+spaceSpan),$appended.append(cntnt+spaceSpan);if($("body").hasClass("compose-mode")){$(".uncode_fe_safe").remove();return}if($title.closest(".marquee-freezed").length)return;($_title.hasClass("un-marquee")||$_title.hasClass("un-marquee-opposite"))&&continuousTextMarquee(),($_title.hasClass("un-marquee-scroll")||$_title.hasClass("un-marquee-scroll-opposite"))&&runTextMarquee()},marqueeResize=function(e){clearRequestTimeout(marqueeCheckResize),marqueeCheckResize=requestTimeout(function(){newW!==UNCODE.wwidth&&(gsap.killTweensOf($title),typeof inview!="undefined"&&inview!==null&&inview.destroy(),typeof marqueeTL!="undefined"&&marqueeTL!==null&&marqueeTL.kill(),first=!0,initTextMarquee(),newW=UNCODE.wwidth)},1e3)};$(window).off("resize uncode.re-layout",marqueeResize).on("resize uncode.re-layout",marqueeResize),cloneSpan($title,txt),$("body").hasClass("compose-mode")&&typeof window.parent.vc!="undefined"&&window.parent.vc.events.on("shortcodeView:updated",function(e){var $_titles=$(".un-text-marquee",e.view.$el);clearRequestTimeout(marqueeCheckResize),marqueeCheckResize=requestTimeout(function(){initTextMarquee($_titles)},1e3)})})};$(document).on("ready",function(){initTextMarquee()}),$(window).on("focus",function(){setTimeout(function(){initTextMarquee()},500)}),$(document).on("pumAfterOpen pumAfterClose",function(args){initTextMarquee()})}})(jQuery)